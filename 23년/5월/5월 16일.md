# TIL

### 데이터 베이스 정규화

코어 데이터를 활용하면서 데이터 베이스의 정규화에 대해서 부족한 개념이 있다고 생각하여 공부하게 되었다. 코어 데이터가 데이터 베이스는 아니지만, 코어 데이터는 내부적으로 SQLite를 활용하기 때문에 관계형 데이터 베이스에서 발생할 수 있는 데이터 문제들을 해결하는 방법이 데이터 정규화이다. 정규화를 하지 않은 경우 발생할 수 있는 문제들은 다음과 같다.

- 데이터를 삽입하는 경우 의도와 다른 값들이 삽입되게 된다.
- 데이터 삭제 시 의도와 다른 값들도 함께 삭제 되게 된다.
- 속성값 갱신 시 일부 튜플만 갱신되어 모순이 발생할 수 있다.

#### 정규화란

정규화는 테이블 간 중복된 데이터를 허용하지 않는 것이다. 중복된 데이터를 허용하지 않음으로써 무결성을 유지할 수 있게 하는 것이다. 무결성이란 데이터의 정확성과 일관성을 유지하고, 이에 대해서 보증하는 것을 의미하게 된다. 즉, 정규화는 저장된 데이터가 중복되지 않고, 일관적인 행위를 하도록 만드는 것이다.

#### 제 1 정규화

다음과 같은 데이터베이스가 존재한다고 가정해보자. 다음과 같은 데이터 베이스가 발생시킬 수 있는 문제는 어떤 것들이 있을까?

- | 수강과목 | 수강자                 |
  | -------- | ---------------------- |
  | 수학     | 홍길동                 |
  | 과학     | 임꺽정, 신사임당       |
  | 사회     | 홍길동, 임꺽정, 고길동 |

| 수강과목 | 수강자1 | 수강자2  | 수강자2 |
| -------- | ------- | -------- | ------- |
| 수학     | 홍길동  |          |         |
| 과학     | 임꺽정  | 신사임당 |         |
| 사회     | 홍길동  | 임꺽정   | 고길동  |

다음과 같은 데이터 베이스를 구축하게 될 경우 다음과 같은 문제가 발생할 수 있다.

- 갱신 이상
  - 홍길동이 사회과목을 역사과목으로 변경하게 되면, 임꺽정이 수강하고 있는 사회 과목도 변경될 수 있다.
- 삭제 이상
  - 임꺽정이 과학 과목을 수강 취소했다. 그럼 신사임당의 수강정보도 삭제 될 수 있다.

이와 같은 문제들을 가장 쉽게 해결하는 방법은 원자값으로 구분하는 것이다.
즉, 다음과 같이 데이터베이스를 구성하는 것이다.

| 수강과목 | 수강자   | 일련번호 |
| -------- | -------- | -------- |
| 수학     | 홍길동   | 1        |
| 과학     | 임꺽정   | 2        |
| 과학     | 신사임당 | 3        |
| 사회     | 홍길동   | 4        |
| 사회     | 임꺽정   | 5        |

#### 제 2 정규화

2 정규화는 1정규화를 진행한 테이블에 대해서 완전 함수 종속을 만족하도록 테이블을 분해하는 것이다. 완전 함수 종속이라는 것은 키본키의 부분집합이 결정자되어서는 안된다는 것이다. 다음과 같은 데이터 베이스를 확인해보자.

| 학생 번호 | 강좌 이름     | 강의실     | 성적 |
| --------- | ------------- | ---------- | ---- |
| 501       | 데이터 베이스 | 공학관 110 | 3.5  |
| 401       | 데이터 베이스 | 공학과 110 | 4.0  |
| 402       | 스포츠 경영학 | 체육관 111 | 4.0  |
| 502       | 자료 구조     | 공학관 202 | 4.0  |
| 503       | 자료 구조     | 공학관 202 | 3.5  |

다음 데이터 베이스는 학생번호와 강의 이름을 함께 사용하는 복합키를 구성하고 있다. 학생번호와 강의이름을 통해서 성적을 결정하고 있다. 하지만, 강의실에 대해서는 강의 이름을 통해서만 결정되고 있다. 즉, 복합키에서 한개만을 사용하여서 결정이 되고 있는 것이다. 이를 해결하기 위해서 완전 함수 종속을 만족 시키도록 두개의 테이블로 분리하면 된다.

| 학생 번호 | 강좌 이름     | 성적 |
| --------- | ------------- | ---- |
| 501       | 데이터 베이스 | 3.5  |
| 401       | 데이터 베이스 | 4.0  |
| 402       | 스포츠 경영학 | 4.0  |
| 502       | 자료 구조     | 4.0  |
| 503       | 자료 구조     | 3.5  |

| 강좌 이름     | 강의실     |
| ------------- | ---------- |
| 데이터베이스  | 공학관 110 |
| 스포츠 경영학 | 체육관 111 |
| 자료구조      | 공학과 202 |

#### 제 3 정규화

제 3 정규화는 2 정규화를 진행한 테이블에 대해서 종속을 없애도록 테이블을 분해하는 것이다. A -> B, B -> C가 성립하게 되는 것에 대해서 A -> C가 성립하도록 하는 것이다.

| 학생 번호 | 강좌 이름     | 수강료 |
| --------- | ------------- | ------ |
| 501       | 데이터 베이스 | 20000  |
| 401       | 데이터 베이스 | 20000  |
| 402       | 스포츠 경영학 | 15000  |
| 502       | 자료 구조     | 25000  |

다음과 같은 테이블은 `학생번호` 를 통해서 `강좌 이름` 을 얻을 수 있고, `강좌이름` 을 통해서 `수강료` 에 대해서 알 수 있게 된다. 이를 `학생번호` 를 통해서 `수강료` 를 알 수 없도록 하는 것이다.

| 학생 번호 | 강좌 이름     |
| --------- | ------------- |
| 501       | 데이터 베이스 |
| 401       | 데이터 베이스 |
| 402       | 스포츠 경영학 |
| 502       | 자료 구조     |

| 강좌 이름     | 수강료 |
| ------------- | ------ |
| 데이터 베이스 | 20000  |
| 데이터 베이스 | 20000  |
| 스포츠 경영학 | 15000  |
| 자료 구조     | 25000  |

#### BNCF 정규화

이는 3정규화를 진행한 테이블에 대해서 모든 결정자가 후보키가 되도록 테이블을 분해하는 것이다.
|학번| 과목| 교수|
|----|----|----|
|100 |데이터베이스| 홍길동|
|100| 자료구조 |임꺽정|
|200| 네트워크 |장영실|
|300| 인공지능| 유관순|

다음과 같은 테이블에서 학번과 과목을 통해서 교수를 결정하게 된다. 여기서 교수는 과목의 이름을 결정하게 된다. 교수가 과목이름의 결정자이지만, 후보키가 아니라는 것이다. 정규화를 하기 위해서 테이블을 분리하여야 한다.

| 학번 | 과목코드 |
| ---- | -------- |
| 100  | DB01     |
| 100  | DS01     |
| 200  | NW01     |
| 300  | AI01     |

| 과목코드 | 과목         | 교수   |
| -------- | ------------ | ------ |
| DB01     | 데이터베이스 | 홍길동 |
| DS01     | 자료구조     | 임꺽정 |
| NW01     | 네트워크     | 장영실 |
| AI01     | 인공지능     | 유관순 |

다음과 같이 구성하게 되면, 학번을 통해서 과목 코드를 결정하고, 과목코드와 교수를 통해서 과목을 결정할 수 있게 된다.